/* Harmony Button v2 â€” tokenized control */
.harm-btn {
  --btn-bg: var(--color-surface);
  --btn-color: var(--color-text);
  --btn-border-color: transparent;
  --btn-border-width: 0px;
  --btn-hover-bg: color-mix(in oklab, var(--btn-bg), var(--btn-color) 6%);
  --btn-hover-color: var(--btn-color);
  --btn-hover-border-color: var(--btn-border-color);
  --btn-clicked-bg: color-mix(in oklab, var(--btn-bg), var(--btn-color) 14%);
  --btn-clicked-color: var(--btn-color);
  --btn-clicked-border-color: var(--btn-border-color);
  --btn-radius: var(--control-radius-md, 0.375rem);
  --btn-height: var(--control-size-lg, 1.75rem);
  /* Inline paddings driven by Harmony spacing scale (default ~md) */
  --btn-icon-box: var(--control-icon-md, 1.5rem);
  /* Glyph size driven by global ratio token */
  --btn-icon-glyph: calc(var(--btn-icon-box) * var(--control-icon-glyph-ratio));
  --btn-icon-color: currentColor;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  /* Gap set per size blocks directly from global tokens */
  gap: var(--control-inline-gap-md);
  min-height: var(--btn-height);
  padding-inline: var(--control-padding-inline);
  padding-block: 0;
  border-radius: var(--btn-radius);
  border: var(--btn-border-width) solid var(--btn-border-color);
  background: var(--btn-bg);
  color: var(--btn-color);
  font: var(--control-text-lg);
  letter-spacing: var(--control-letter-spacing, 0);
  text-decoration: none;
  white-space: nowrap;
  cursor: pointer;
  transition:
    background-color 150ms ease,
    color 150ms ease,
    border-color 150ms ease,
    box-shadow 150ms ease,
    transform 150ms ease;
}

.harm-btn > * { pointer-events: none; }

@media (prefers-reduced-motion: reduce) {
  .harm-btn { transition: none; }
}

.harm-btn[data-size="xs"] {
  /* xs size: 16px rail */
  --btn-height: var(--control-size-xs, 1rem);
  --btn-radius: var(--control-radius-xs, 0.25rem);
  gap: var(--control-inline-gap-xs);
  --btn-icon-box: var(--control-icon-xs, 1rem);
  /* XS override: glyph ratio from token */
  --btn-icon-glyph: calc(var(--btn-icon-box) * var(--control-icon-glyph-ratio-xs));
  font: var(--control-text-xs);
}

.harm-btn[data-size="sm"] {
  --btn-height: var(--control-size-sm, 1.25rem);
  --btn-radius: var(--control-radius-sm, 0.3125rem);
  gap: var(--control-inline-gap-xs);
  --btn-icon-box: var(--control-icon-xs, 1rem);
  /* sm buttons reuse the XS icon ladder */
  --btn-icon-glyph: calc(var(--btn-icon-box) * var(--control-icon-glyph-ratio-xs));
  font: var(--control-text-sm);
}

.harm-btn[data-size="md"] {
  --btn-height: var(--control-size-md, 1.5rem);
  --btn-radius: var(--control-radius-md, 0.375rem);
  gap: var(--control-inline-gap-sm);
  --btn-icon-box: var(--control-icon-sm, 1.25rem);
  /* md: glyph ratio token */
  --btn-icon-glyph: calc(var(--btn-icon-box) * var(--control-icon-glyph-ratio-sm));
  font: var(--control-text-md);
}

.harm-btn[data-size="lg"] {
  --btn-height: var(--control-size-lg, 1.75rem);
  /* Normalize to spacing scale: lg uses space-3 */
  --btn-radius: var(--control-radius-lg, 0.4375rem);
  gap: var(--control-inline-gap-sm);
  --btn-icon-box: var(--control-icon-sm, 1.25rem);
  /* Use global 80% */
  --btn-icon-glyph: calc(var(--btn-icon-box) * var(--control-icon-glyph-ratio-sm));
  font: var(--control-text-lg);
}

.harm-btn[data-size="xl"] {
  --btn-height: var(--control-size-xl, 2rem);
  /* Normalize to spacing scale: xl uses space-3 */
  --btn-radius: var(--control-radius-xl, 0.5rem);
  gap: var(--control-inline-gap-md);
  --btn-icon-box: var(--control-icon-sm, 1.25rem);
  /* XL shares the SM icon ladder to keep glyphs compact */
  --btn-icon-glyph: calc(var(--btn-icon-box) * var(--control-icon-glyph-ratio-sm));
  font: var(--control-text-xl);
}

.harm-btn__icon {
  inline-size: var(--btn-icon-box);
  block-size: var(--btn-icon-box);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  color: var(--btn-icon-color);
  flex: none;
}

.harm-btn__icon svg {
  inline-size: var(--btn-icon-glyph);
  block-size: var(--btn-icon-glyph);
  display: block;
}

.harm-btn__label {
  display: inline-flex;
  align-items: center;
  font: inherit;
  white-space: nowrap;
  padding-inline: var(--space-0);
}


.harm-btn[data-type="text-only"] {
  gap: 0;
}

.harm-btn[data-type="icon-text"] {
  /* Normalize: use same left padding as text-only; icon-only remains square */
}


.harm-btn[data-type="icon-only"] {
  inline-size: var(--btn-height);
  block-size: var(--btn-height);
  min-height: var(--btn-height);
  padding: 0;
}

/* XS icon-only: ensure glyph is 97% of the square (height-based) */
.harm-btn[data-type="icon-only"][data-size="xs"] {
  --btn-icon-glyph: calc(var(--btn-height) * var(--control-icon-glyph-ratio-xs));
}

.harm-btn[data-type="icon-only"] .harm-btn__icon {
  inline-size: 100%;
  block-size: 100%;
}

/* Alignment Utilities */
.harm-btn--align-start { justify-content: flex-start; }
.harm-btn--align-end { justify-content: flex-end; }
.harm-btn--split { justify-content: space-between; }
.harm-btn--block { inline-size: 100%; }

.harm-btn:hover:not(:disabled):not([aria-disabled="true"]) {
  background: var(--btn-hover-bg);
  color: var(--btn-hover-color);
  border-color: var(--btn-hover-border-color);
}

.harm-btn:active:not(:disabled):not([aria-disabled="true"]) {
  background: var(--btn-clicked-bg);
  color: var(--btn-clicked-color);
  border-color: var(--btn-clicked-border-color);
  transform: translateY(1px);
}

.harm-btn[aria-pressed="true"] {
  background: var(--btn-clicked-bg);
  color: var(--btn-clicked-color);
  border-color: var(--btn-clicked-border-color);
}

.harm-btn:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 var(--focus-ring-offset, 2px) var(--color-bg, #ffffff),
    0 0 0 calc(var(--focus-ring-offset, 2px) + var(--focus-ring-width, 2px)) var(--focus-ring-color, var(--color-accent));
}

.harm-btn:disabled,
.harm-btn[aria-disabled="true"] {
  opacity: 0.48;
  cursor: not-allowed;
}

/* Variants */
.harm-btn[data-variant="primary"] {
  --btn-bg: var(--color-system-blue, #0a84ff);
  --btn-color: var(--color-system-white, #ffffff);
  --btn-border-color: transparent;
  --btn-hover-bg: color-mix(in oklab, var(--color-system-blue, #0a84ff), #000000 22%);
  --btn-clicked-bg: color-mix(in oklab, var(--color-system-blue, #0a84ff), #000000 40%);
}

.harm-btn[data-variant="secondary"] {
  /* Transparent overlay mix (matches Segmented rail logic) */
  --btn-bg: color-mix(in oklab, var(--color-text) 8%, transparent);
  --btn-border-width: 0px;
  --btn-border-color: transparent;
  --btn-hover-bg: color-mix(in oklab, var(--color-text) 12%, transparent);
  --btn-clicked-bg: color-mix(in oklab, var(--color-text) 20%, transparent);
}

.harm-btn[data-variant="neutral"] {
  --btn-bg: transparent;
  --btn-border-color: transparent;
  --btn-hover-bg: color-mix(in oklab, var(--color-text), transparent 88%);
  --btn-clicked-bg: color-mix(in oklab, var(--color-text), transparent 75%);
}

.harm-btn[data-variant="line1"] {
  --btn-bg: transparent;
  --btn-color: var(--color-system-blue, #0a84ff);
  --btn-border-width: 1px;
  --btn-border-color: var(--color-system-blue, #0a84ff);
  --btn-hover-bg: color-mix(in oklab, var(--color-system-blue, #0a84ff), transparent 60%);
  --btn-clicked-bg: color-mix(in oklab, var(--color-system-blue, #0a84ff), transparent 30%);
}

.harm-btn[data-variant="line2"] {
  --btn-bg: transparent;
  --btn-color: var(--color-system-gray-2, #aeaeb2);
  --btn-border-width: 1px;
  --btn-border-color: var(--color-system-gray-2, #aeaeb2);
  --btn-hover-bg: color-mix(in oklab, var(--color-system-gray-2, #aeaeb2), transparent 75%);
  --btn-clicked-bg: color-mix(in oklab, var(--color-system-gray-2, #aeaeb2), transparent 55%);
}

/* Loading state */
.harm-btn[data-state="loading"] {
  position: relative;
  pointer-events: none;
}

.harm-btn[data-state="loading"]::after {
  content: "";
  inline-size: calc(var(--btn-icon-box) * 0.75);
  block-size: calc(var(--btn-icon-box) * 0.75);
  border: 2px solid color-mix(in oklab, var(--btn-color), transparent 60%);
  border-top-color: var(--btn-color);
  border-radius: 999px;
  animation: harm-btn-spin 0.8s linear infinite;
}

@keyframes harm-btn-spin {
  to { transform: rotate(360deg); }
}

/* Dark theme adjustments */
@media (prefers-color-scheme: dark) {
  .harm-btn {
    --btn-hover-bg: color-mix(in oklab, var(--btn-bg), var(--btn-color) 10%);
    --btn-clicked-bg: color-mix(in oklab, var(--btn-bg), var(--btn-color) 22%);
  }

  .harm-btn[data-variant="primary"],
  .harm-btn[data-variant="primary"] {
    --btn-color: var(--color-system-white, #f5f6f8);
    --btn-hover-bg: color-mix(in oklab, var(--color-system-blue, #0a84ff), #000000 22%);
    --btn-clicked-bg: color-mix(in oklab, var(--color-system-blue, #0a84ff), #000000 40%);
  }

  .harm-btn[data-variant="secondary"] {
    /* Keep the same transparent text overlay system in dark */
    --btn-bg: color-mix(in oklab, var(--color-text) 8%, transparent);
    --btn-border-color: transparent;
    --btn-hover-bg: color-mix(in oklab, var(--color-text) 12%, transparent);
    --btn-clicked-bg: color-mix(in oklab, var(--color-text) 20%, transparent);
  }

  .harm-btn[data-variant="neutral"] {
    --btn-hover-bg: color-mix(in oklab, var(--color-system-white, #f5f6f8), transparent 88%);
    --btn-clicked-bg: color-mix(in oklab, var(--color-system-white, #f5f6f8), transparent 70%);
  }

  .harm-btn[data-variant="line1"] {
    --btn-color: var(--color-system-blue, #0a84ff);
    --btn-border-color: var(--color-system-blue, #0a84ff);
    --btn-hover-bg: color-mix(in oklab, var(--color-system-blue, #0a84ff), transparent 68%);
    --btn-clicked-bg: color-mix(in oklab, var(--color-system-blue, #0a84ff), transparent 46%);
  }

  .harm-btn[data-variant="line2"] {
    --btn-color: var(--color-system-gray-2, #aeaeb2);
    --btn-border-color: var(--color-system-gray-2, #aeaeb2);
    --btn-hover-bg: color-mix(in oklab, var(--color-system-gray-2, #aeaeb2), transparent 68%);
    --btn-clicked-bg: color-mix(in oklab, var(--color-system-gray-2, #aeaeb2), transparent 46%);
  }
}
